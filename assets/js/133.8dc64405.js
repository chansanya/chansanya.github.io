(window.webpackJsonp=window.webpackJsonp||[]).push([[133],{432:function(a,t,e){"use strict";e.r(t);var s=e(15),r=Object(s.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h2",{attrs:{id:"caddy操作指南"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#caddy操作指南"}},[a._v("#")]),a._v(" Caddy操作指南")]),a._v(" "),t("ul",[t("li",[t("strong",[t("a",{attrs:{href:"https://caddyserver.com/docs/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Caddy"),t("OutboundLink")],1)]),a._v(" 是一款现代化、自动化、简洁的Web服务器。")]),a._v(" "),t("li",[a._v("支持自动TLS证书管理、反向代理、静态文件服务等。")])]),a._v(" "),t("h3",{attrs:{id:"基础命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基础命令"}},[a._v("#")]),a._v(" 基础命令")]),a._v(" "),t("h4",{attrs:{id:"检查配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查配置文件"}},[a._v("#")]),a._v(" 检查配置文件")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("caddy validate "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--config")]),a._v(" /path/to/Caddyfile\n")])])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[a._v("提示")]),a._v(" "),t("p",[a._v("如果不带"),t("code",[a._v("--config")]),a._v("参数，默认加载"),t("code",[a._v("当前目录")]),a._v("下"),t("code",[a._v("Caddyfile")]),a._v(",否则加载"),t("code",[a._v("系统默认路径")]),a._v("。")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",[a._v("操作系统")]),a._v(" "),t("th",[a._v("默认（相对安装路径）")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[a._v("Linux")]),a._v(" "),t("td",[t("code",[a._v("caddy/Caddyfile")])])]),a._v(" "),t("tr",[t("td",[a._v("Windows")]),a._v(" "),t("td",[t("code",[a._v("Caddy/Caddyfile")])])]),a._v(" "),t("tr",[t("td",[a._v("macOS")]),a._v(" "),t("td",[t("code",[a._v("caddy/Caddyfile")])])])])])]),a._v(" "),t("p",[t("makr")],1),a._v(" "),t("h4",{attrs:{id:"前台启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前台启动"}},[a._v("#")]),a._v(" 前台启动")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("caddy run\n")])])]),t("h4",{attrs:{id:"作为服务启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#作为服务启动"}},[a._v("#")]),a._v(" 作为服务启动")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("caddy start\n")])])]),t("h4",{attrs:{id:"重新加载配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#重新加载配置"}},[a._v("#")]),a._v(" 重新加载配置")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("caddy reload "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--config")]),a._v(" /path/to/Caddyfile\n")])])]),t("h3",{attrs:{id:"docker-compose-安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-安装"}},[a._v("#")]),a._v(" docker-compose 安装")]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'3.8'")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("caddy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" caddy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"80:80"')]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"443:443"')]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" ./Caddyfile"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/etc/caddy/Caddyfile\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" ./caddy_data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/data\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" ./caddy_config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/config\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("networks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" prod "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 指定网络")]),a._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("networks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("prod")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("external")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("true")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用现有网络")]),a._v("\n")])])]),t("h3",{attrs:{id:"caddyfile"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#caddyfile"}},[a._v("#")]),a._v(" Caddyfile")]),a._v(" "),t("h4",{attrs:{id:"最简单示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#最简单示例"}},[a._v("#")]),a._v(" 最简单示例")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v(":80 {\n    #代理到8080\n    reverse_proxy localhost:8080\n}\n")])])]),t("h3",{attrs:{id:"反代多个站点-基于子域"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#反代多个站点-基于子域"}},[a._v("#")]),a._v(" 反代多个站点（基于子域）")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("a.example.com {\n    reverse_proxy localhost:5244\n}\n\nb.example.com {\n    reverse_proxy localhost:8080\n}\n\nc.example.com {\n    reverse_proxy localhost:9000\n}\n")])])]),t("h4",{attrs:{id:"自动https-使用域名"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自动https-使用域名"}},[a._v("#")]),a._v(" 自动HTTPS（使用域名）")]),a._v(" "),t("blockquote",[t("p",[a._v("首先需要一个正常解析到IP的域名吗，这是必要条件")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("example.com {\n    tls you@example.com #通知邮箱\n    #代理到8080\n    reverse_proxy localhost:8080\n}\n")])])]),t("p",[a._v("上面示例："),t("mark",[a._v("HTTP会强制调整HTTPS （使用默认 80 → 443）")])]),a._v(" "),t("h4",{attrs:{id:"自签证书-无域名"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自签证书-无域名"}},[a._v("#")]),a._v(" 自签证书（无域名）")]),a._v(" "),t("p",[t("strong",[a._v("生成自签名证书")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("openssl req "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-x509")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-newkey")]),a._v(" rsa:2048 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-nodes")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-keyout")]),a._v(" /etc/caddy/ssl/key.pem  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-out")]),a._v(" /etc/caddy/ssl/cert.pem "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-days")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("365")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-subj")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/CN=your.ip.address"')]),a._v("\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v(":8443 {\n    tls /etc/caddy/ssl/cert.pem /etc/caddy/ssl/key.pem\n    reverse_proxy localhost:8080\n}\n")])])]),t("h3",{attrs:{id:"http-→-https-手动跳转-特殊端口"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#http-→-https-手动跳转-特殊端口"}},[a._v("#")]),a._v(" HTTP → HTTPS 手动跳转（特殊端口）")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("example.com:8080 {\n    redir https://example.com:8443{uri}\n}\n\nexample.com:8443 {\n    tls you@example.com\n    reverse_proxy localhost:5244\n}\n")])])]),t("h3",{attrs:{id:"启用静态文件服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启用静态文件服务"}},[a._v("#")]),a._v(" 启用静态文件服务")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("example.com {\n    # * 匹配所以请求\n    # 静态资源存放目录\n    root * /path/to/your/files\n    file_server\n}\n")])])]),t("h3",{attrs:{id:"路由控制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#路由控制"}},[a._v("#")]),a._v(" 路由控制")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("example.com {\n    redir /old-url /new-url 301\n\n    handle_path /blog/* {\n        reverse_proxy localhost:8080\n    }\n\n    handle_path /api/* {\n        reverse_proxy localhost:5000\n    }\n\n    handle * {\n        root * /var/www/html\n        file_server\n    }\n}\n\n")])])]),t("h3",{attrs:{id:"启用压缩和跨域"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启用压缩和跨域"}},[a._v("#")]),a._v(" 启用压缩和跨域")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('example.com {\n    encode gzip\n    header {\n        Access-Control-Allow-Origin "*"\n        X-Content-Type-Options "nosniff"\n    }\n    reverse_proxy localhost:5244\n}\n')])])]),t("h3",{attrs:{id:"基础认证-http-basic-auth"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基础认证-http-basic-auth"}},[a._v("#")]),a._v(" 基础认证（HTTP Basic Auth）")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("example.com {\n    route {\n        basicauth / admin JDJhJDEyJHZiRzZwbjdVZUl4U0ZBQnM3L3lZZVJ4RnVaZlFlZ29IZUtIM0hoR0FZME1XNGRtd01yCnY2Vjhi\n        reverse_proxy localhost:5244\n    }\n}\n")])])]),t("p",[a._v("可用"),t("code",[a._v("caddy hash-password")]),a._v(" 生成hash密码")]),a._v(" "),t("h3",{attrs:{id:"限制正文大小"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#限制正文大小"}},[a._v("#")]),a._v(" 限制正文大小")]),a._v(" "),t("h4",{attrs:{id:"配置全局"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置全局"}},[a._v("#")]),a._v(" 配置全局")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("{\n    # 全局配置（可选）\n    # 限制所有请求的最大请求体大小\n    # 例如，限制请求体至10MB\n    request_body {\n        max_size 10MB\n    }\n}\n\n")])])]),t("h4",{attrs:{id:"配置站点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置站点"}},[a._v("#")]),a._v(" 配置站点")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("example.com {\n    request_body {\n        max_size 5MB\n    }\n    # 其他配置，比如反向代理或文件服务\n    reverse_proxy localhost:8080\n}\n\n")])])]),t("p",[t("strong",[a._v("超出限制处理")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('example.com {\n    # 范围：限制请求体最大为10MB\n    @limit {\n        request_body {\n            max_size 10MB\n        }\n    }\n    handle @limit {\n        # 拒绝超出限制的请求\n        respond "Payload Too Large" 413\n    }\n    reverse_proxy localhost:8080\n}\n')])])]),t("p",[t("strong",[a._v("基于匹配条件的限制")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("example.com {\n    @large_body {\n        header Content-Length * # 只限制具有Content-Length的请求\n    }\n    handle @large_body {\n        request_body {\n            max_size 20MB\n        }\n        # 后续中间件或响应\n        reverse_proxy localhost:8080\n    }\n\n    # 对非匹配的请求继续处理\n    handle {\n        reverse_proxy localhost:8080\n    }\n}\n")])])]),t("h2",{attrs:{id:"tls属性示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tls属性示例"}},[a._v("#")]),a._v(" tls属性示例")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("tls <email> {\n    ca <acme-server-url>\n    dns <provider>\n    on_demand\n    resolvers <ip>...\n    ask <url>\n    alpn <proto>...\n    protocols <version>...\n    client_auth {\n        mode <request|require|verify_if_given|require_and_verify>\n        trusted_ca_cert_file <path>\n        trusted_ca_cert_files <paths...>\n    }\n    cert_file <path/to/cert.pem>\n    key_file <path/to/key.pem>\n}\n")])])]),t("h3",{attrs:{id:"字段说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#字段说明"}},[a._v("#")]),a._v(" 字段说明")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",[a._v("配置项")]),a._v(" "),t("th",[a._v("描述")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[t("code",[a._v("tls you@example.com")])]),a._v(" "),t("td",[a._v("指定邮箱（用于 Let's Encrypt 注册）")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v("ca")])]),a._v(" "),t("td",[a._v("自定义 ACME CA（比如 Let's Encrypt 以外的）")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v("dns")])]),a._v(" "),t("td",[a._v("启用 DNS 认证（需要 Caddy 插件）")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v("on_demand")])]),a._v(" "),t("td",[a._v("启用按需证书（首次访问时申请）")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v("resolvers")])]),a._v(" "),t("td",[a._v("自定义 DNS 解析器（默认用系统）")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v("ask")])]),a._v(" "),t("td",[a._v("访问特定 URL 判断是否允许发证书")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v("alpn")])]),a._v(" "),t("td",[a._v("限制允许的 ALPN 协议（HTTP/2, h3 等）")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v("protocols")])]),a._v(" "),t("td",[a._v("限制支持的 TLS 版本（如 tls1.2 tls1.3）")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v("client_auth")])]),a._v(" "),t("td",[a._v("启用客户端证书认证（双向 TLS）")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v("cert_file / key_file")])]),a._v(" "),t("td",[a._v("手动指定证书和私钥（跳过 ACME）")])])])])])}),[],!1,null,null,null);t.default=r.exports}}]);