(window.webpackJsonp=window.webpackJsonp||[]).push([[98],{445:function(t,s,a){"use strict";a.r(s);var r=a(14),e=Object(r.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"🧱-常用指令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🧱-常用指令"}},[t._v("#")]),t._v(" 🧱 常用指令")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("指令")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("FROM")])]),t._v(" "),s("td",[t._v("指定基础镜像")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("RUN")])]),t._v(" "),s("td",[t._v("执行命令，例如安装软件包")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("COPY")])]),t._v(" "),s("td",[t._v("复制文件到容器中")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("ADD")])]),t._v(" "),s("td",[t._v("类似 COPY，还支持 URL 和压缩包自动解压")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("WORKDIR")])]),t._v(" "),s("td",[t._v("设置工作目录")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("CMD")])]),t._v(" "),s("td",[t._v("指定容器启动时执行的命令（只能有一个）")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("ENTRYPOINT")])]),t._v(" "),s("td",[t._v("设置主启动命令（可搭配 CMD）")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("ENV")])]),t._v(" "),s("td",[t._v("设置环境变量")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("EXPOSE")])]),t._v(" "),s("td",[t._v("指定容器监听端口")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("ARG")])]),t._v(" "),s("td",[t._v("构建参数（与 ENV 类似，但只在构建阶段有效）")])])])]),t._v(" "),s("h2",{attrs:{id:"基础镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基础镜像"}},[t._v("#")]),t._v(" 基础镜像")]),t._v(" "),s("h3",{attrs:{id:"scratch"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#scratch"}},[t._v("#")]),t._v(" scratch")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("Docker 中最小的空白基础镜像")])]),t._v(" "),s("li",[s("p",[t._v("适合构建极简静态编译程序镜像（如 Go 应用）")])])]),t._v(" "),s("h3",{attrs:{id:"bosybox"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#bosybox"}},[t._v("#")]),t._v(" bosybox")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("集成常用 Linux 工具的精简工具箱")])]),t._v(" "),s("li",[s("p",[t._v("镜像小巧（仅几 MB），便于快速验证")])])]),t._v(" "),s("h3",{attrs:{id:"alpine"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#alpine"}},[t._v("#")]),t._v(" Alpine")]),t._v(" "),s("ul",[s("li",[t._v("轻量级、安全性高的 Linux 发行版")]),t._v(" "),s("li",[t._v("功能完善，内置包管理器 apk，适合生产环境S")])]),t._v(" "),s("h2",{attrs:{id:"示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#示例"}},[t._v("#")]),t._v(" 示例")]),t._v(" "),s("h3",{attrs:{id:"🧪-spring-boot-应用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🧪-spring-boot-应用"}},[t._v("#")]),t._v(" 🧪 Spring Boot 应用")]),t._v(" "),s("div",{staticClass:"language-dockerfile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" adoptopenjdk/openjdk8:alpine-jre")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENV")]),t._v(" TZ=Asia/Shanghai")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ARG")]),t._v(" JAR_FILE=target/*.jar")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${JAR_FILE}")]),t._v(" app.jar")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("EXPOSE")]),t._v(" 8080")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENTRYPOINT")]),t._v(" ["),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"java"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-jar"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/app.jar"')]),t._v("]")]),t._v("\n")])])]),s("h3",{attrs:{id:"🧱-python-应用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🧱-python-应用"}},[t._v("#")]),t._v(" 🧱 Python 应用")]),t._v(" "),s("div",{staticClass:"language-Dockerfile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" python:3.10-slim")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WORKDIR")]),t._v(" /app")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" requirements.txt ./")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" pip install --no-cache-dir -r requirements.txt")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" . .")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CMD")]),t._v(" ["),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"python"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"main.py"')]),t._v("]")]),t._v("\n")])])]),s("h3",{attrs:{id:"🐳-vue-应用-多阶段构建-multi-stage-build"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🐳-vue-应用-多阶段构建-multi-stage-build"}},[t._v("#")]),t._v(" 🐳 Vue 应用 多阶段构建（Multi-stage Build）")]),t._v(" "),s("p",[t._v("用于构建更小、更安全的镜像。")]),t._v(" "),s("div",{staticClass:"language-Dockerfile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 构建阶段")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" node:18-alpine "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" builder")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WORKDIR")]),t._v(" /app")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" . .")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" npm install && npm run build")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 运行阶段")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" nginx:stable-alpine")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token options"}},[s("span",{pre:!0,attrs:{class:"token property"}},[t._v("--from")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("builder")])]),t._v(" /app/dist /usr/share/nginx/html")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" nginx/nginx.conf /etc/nginx/nginx.conf")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("EXPOSE")]),t._v(" 80")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CMD")]),t._v(" ["),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-g"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"daemon off;"')]),t._v("]")]),t._v("\n")])])]),s("p",[t._v("✅  优势：构建依赖不会进入最终镜像，提升安全性与体积优化。")]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"⚡-缓存优化技巧"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#⚡-缓存优化技巧"}},[t._v("#")]),t._v(" ⚡ 缓存优化技巧")]),t._v(" "),s("p",[t._v("镜像构建是按层进行的，合理拆分指令顺序可以更好利用缓存。")]),t._v(" "),s("div",{staticClass:"language-Dockerfile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" requirements.txt ./")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" pip install -r requirements.txt")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" . .")]),t._v("\n")])])]),s("p",[t._v("📌 建议：将变动小的文件优先 COPY，避免因频繁变动导致缓存失效。")]),t._v(" "),s("h3",{attrs:{id:"🛠️-构建与运行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🛠️-构建与运行"}},[t._v("#")]),t._v(" 🛠️ 构建与运行")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 构建镜像")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" build "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" my-app "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 运行容器")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v(":3000 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" my-container my-app\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 进入容器")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-it")]),t._v(" my-container "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v("\n")])])]),s("h2",{attrs:{id:"📁-dockerignore"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#📁-dockerignore"}},[t._v("#")]),t._v(" 📁 .dockerignore")]),t._v(" "),s("p",[t._v("类似 "),s("code",[t._v(".gitignore")]),t._v("，可以防止某些文件被加入构建上下文。")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("node_modules\n*.log\nDockerfile\n.dockerignore\n.git\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);