(window.webpackJsonp=window.webpackJsonp||[]).push([[97],{507:function(s,a,t){"use strict";t.r(a);var e=t(15),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("Swap 文件或 Swap 分区是在物理内存（RAM）不足时的一个补充存储区域，它允许操作系统将不活跃的内存页面移到磁盘上，从而释放物理内存用于其他活动进程。适合对不常用的小机器进行内存扩容\n")]),s._v(" "),a("h3",{attrs:{id:"开启swap"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开启swap"}},[s._v("#")]),s._v(" 开启Swap")]),s._v(" "),a("h4",{attrs:{id:"创建-swap-文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建-swap-文件"}},[s._v("#")]),s._v(" 创建 Swap 文件")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" fallocate "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" 4G /swapfile\n")])])]),a("h4",{attrs:{id:"设置文件权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置文件权限"}},[s._v("#")]),s._v(" 设置文件权限")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" /swapfile\n\n")])])]),a("h4",{attrs:{id:"设置-swap-区域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置-swap-区域"}},[s._v("#")]),s._v(" 设置 Swap 区域")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkswap")]),s._v(" /swapfile\n\n")])])]),a("h4",{attrs:{id:"启用-swap-区域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启用-swap-区域"}},[s._v("#")]),s._v(" 启用 Swap 区域")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("swapon")]),s._v(" /swapfile\n")])])]),a("h4",{attrs:{id:"编辑-fstab-文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编辑-fstab-文件"}},[s._v("#")]),s._v(" . 编辑 FSTAB 文件")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改 /etc/fstab 文件,确保在重启后自动挂载")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/swapfile none swap sw 0 0'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" /etc/fstab\n")])])]),a("h3",{attrs:{id:"查看swap信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看swap信息"}},[s._v("#")]),s._v(" 查看Swap信息")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("swapon")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--show")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 等效于")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("swapon")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v("\n")])])]),a("p",[s._v("显示内存的使用情况，包括物理内存和 Swap 的使用情况")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v("\n")])])]),a("p",[s._v("查看 /proc/swaps")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 包含了当前启用的所有 Swap 区域的信息")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /proc/swaps\n")])])]),a("h3",{attrs:{id:"影响-swap-使用的参数-vm-swappiness"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#影响-swap-使用的参数-vm-swappiness"}},[s._v("#")]),s._v(" 影响 Swap 使用的参数：vm.swappiness")]),s._v(" "),a("p",[s._v("Linux 内核参数 vm.swappiness 影响 Swap 的使用频率：")]),s._v(" "),a("ul",[a("li",[s._v("值范围是 0 到 100，默认值通常是 60。")]),s._v(" "),a("li",[s._v("值越高，系统越倾向于使用 Swap；值越低，系统更倾向于优先使用物理内存，尽可能少用 Swap。")])]),s._v(" "),a("p",[s._v("可以用以下命令查看：")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /proc/sys/vm/swappiness\n")])])]),a("p",[a("strong",[s._v("用于临时修改：")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("vm.swappiness")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n")])])]),a("p",[a("strong",[s._v("永久生效")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nano")]),s._v(" /etc/sysctl.conf\n")])])]),a("p",[s._v("新增"),a("code",[s._v("vm.swappiness=10")])]),s._v(" "),a("p",[a("strong",[s._v("应用设置")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v("\n")])])]),a("h3",{attrs:{id:"手动释放"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#手动释放"}},[s._v("#")]),s._v(" 手动释放")]),s._v(" "),a("p",[s._v("Swap 是动态使用的，系统会自动管理")]),s._v(" "),a("p",[s._v("当系统内存紧张时，会把部分内存数据移到 Swap，这样进程可以继续正常运行。\n当系统物理内存变得空闲（比如进程释放了内存，或者系统负载降低），Linux 会自动将 Swap 中的数据页面换回到物理内存中，然后释放对应的 Swap 空间。")]),s._v(" "),a("p",[s._v("换句话说，Swap 空间的数据并不是永久占用的，Linux 内核会根据当前内存压力和系统需求动态地将 Swap 空间“清理”或重新利用。这个过程对用户是透明的。")]),s._v(" "),a("p",[a("strong",[s._v("不需要手动“释放”Swap，内核会自动管理")]),s._v("\n你一般不用手动释放 Swap。Linux 内核有一套复杂的内存管理机制，会根据系统状况自动调整 Swap 和物理内存的使用比例。")]),s._v(" "),a("p",[s._v("不过，如果你确实需要手动释放 Swap（比如你刚关闭了大量的进程，想立刻把 Swap 释放），也可以用下面的命令：")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#关闭所有 Swap，系统会把 Swap 页换回物理内存（如果内存不足，这可能导致系统变慢甚至卡死）。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" swapoff "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v("\n")])])]),a("p",[s._v("或者")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重新启用所有 Swap")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("swapon")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v("\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);