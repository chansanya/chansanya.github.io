(window.webpackJsonp=window.webpackJsonp||[]).push([[96],{506:function(a,s,t){"use strict";t.r(s);var e=t(14),n=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("p",[a._v("Swap 文件或 Swap 分区是在物理内存（RAM）不足时的一个补充存储区域，它允许操作系统将不活跃的内存页面移到磁盘上，从而释放物理内存用于其他活动进程。适合对不常用的小机器进行内存扩容\n")]),a._v(" "),s("h3",{attrs:{id:"开启swap"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开启swap"}},[a._v("#")]),a._v(" 开启Swap")]),a._v(" "),s("h4",{attrs:{id:"创建-swap-文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建-swap-文件"}},[a._v("#")]),a._v(" 创建 Swap 文件")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" fallocate "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v(" 4G /swapfile\n")])])]),s("h4",{attrs:{id:"设置文件权限"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设置文件权限"}},[a._v("#")]),a._v(" 设置文件权限")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("600")]),a._v(" /swapfile\n\n")])])]),s("h4",{attrs:{id:"设置-swap-区域"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设置-swap-区域"}},[a._v("#")]),a._v(" 设置 Swap 区域")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkswap")]),a._v(" /swapfile\n\n")])])]),s("h4",{attrs:{id:"启用-swap-区域"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启用-swap-区域"}},[a._v("#")]),a._v(" 启用 Swap 区域")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("swapon")]),a._v(" /swapfile\n")])])]),s("h4",{attrs:{id:"编辑-fstab-文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#编辑-fstab-文件"}},[a._v("#")]),a._v(" . 编辑 FSTAB 文件")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 修改 /etc/fstab 文件,确保在重启后自动挂载")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'/swapfile none swap sw 0 0'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tee")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-a")]),a._v(" /etc/fstab\n")])])]),s("h3",{attrs:{id:"查看swap信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看swap信息"}},[a._v("#")]),a._v(" 查看Swap信息")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("swapon")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--show")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 等效于")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("swapon")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v("\n")])])]),s("p",[a._v("显示内存的使用情况，包括物理内存和 Swap 的使用情况")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("free")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-h")]),a._v("\n")])])]),s("p",[a._v("查看 /proc/swaps")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 包含了当前启用的所有 Swap 区域的信息")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" /proc/swaps\n")])])]),s("h3",{attrs:{id:"影响-swap-使用的参数-vm-swappiness"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#影响-swap-使用的参数-vm-swappiness"}},[a._v("#")]),a._v(" 影响 Swap 使用的参数：vm.swappiness")]),a._v(" "),s("p",[a._v("Linux 内核参数 vm.swappiness 影响 Swap 的使用频率：")]),a._v(" "),s("ul",[s("li",[a._v("值范围是 0 到 100，默认值通常是 60。")]),a._v(" "),s("li",[a._v("值越高，系统越倾向于使用 Swap；值越低，系统更倾向于优先使用物理内存，尽可能少用 Swap。")])]),a._v(" "),s("p",[a._v("可以用以下命令查看：")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" /proc/sys/vm/swappiness\n")])])]),s("p",[s("strong",[a._v("用于临时修改：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sysctl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("vm.swappiness")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v("\n")])])]),s("h3",{attrs:{id:"手动释放"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#手动释放"}},[a._v("#")]),a._v(" 手动释放")]),a._v(" "),s("p",[a._v("Swap 是动态使用的，系统会自动管理")]),a._v(" "),s("p",[a._v("当系统内存紧张时，会把部分内存数据移到 Swap，这样进程可以继续正常运行。\n当系统物理内存变得空闲（比如进程释放了内存，或者系统负载降低），Linux 会自动将 Swap 中的数据页面换回到物理内存中，然后释放对应的 Swap 空间。")]),a._v(" "),s("p",[a._v("换句话说，Swap 空间的数据并不是永久占用的，Linux 内核会根据当前内存压力和系统需求动态地将 Swap 空间“清理”或重新利用。这个过程对用户是透明的。")]),a._v(" "),s("p",[s("strong",[a._v("不需要手动“释放”Swap，内核会自动管理")]),a._v("\n你一般不用手动释放 Swap。Linux 内核有一套复杂的内存管理机制，会根据系统状况自动调整 Swap 和物理内存的使用比例。")]),a._v(" "),s("p",[a._v("不过，如果你确实需要手动释放 Swap（比如你刚关闭了大量的进程，想立刻把 Swap 释放），也可以用下面的命令：")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#关闭所有 Swap，系统会把 Swap 页换回物理内存（如果内存不足，这可能导致系统变慢甚至卡死）。")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" swapoff "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-a")]),a._v("\n")])])]),s("p",[a._v("或者")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#重新启用所有 Swap")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("swapon")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-a")]),a._v("\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);