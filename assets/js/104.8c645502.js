(window.webpackJsonp=window.webpackJsonp||[]).push([[104],{463:function(a,t,s){"use strict";s.r(t);var e=s(15),n=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h2",{attrs:{id:"前言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[a._v("#")]),a._v(" 前言")]),a._v(" "),t("p",[a._v("本文介绍如何在 Docker 容器中使用 Nvidia 显卡，适用于深度学习、AI 推理等需要 GPU 加速的场景。")]),a._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[a._v("提示")]),a._v(" "),t("p",[a._v("以下环境均为 "),t("strong",[a._v("Ubuntu 22.04")]),a._v("，其他版本请根据实际情况调整。")])]),a._v(" "),t("h2",{attrs:{id:"一、主机显卡查看"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一、主机显卡查看"}},[a._v("#")]),a._v(" 一、主机显卡查看")]),a._v(" "),t("h3",{attrs:{id:"查看主机显卡型号"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看主机显卡型号"}},[a._v("#")]),a._v(" 查看主机显卡型号")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("lspci "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" NVIDIA\n")])])]),t("h3",{attrs:{id:"查看详细显卡信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看详细显卡信息"}},[a._v("#")]),a._v(" 查看详细显卡信息")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("lspci "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("lspci "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'nvidia'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("head")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cut")]),a._v(" -d"),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("' '")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f1")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n")])])]),t("h2",{attrs:{id:"二、安装-nvidia-驱动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二、安装-nvidia-驱动"}},[a._v("#")]),a._v(" 二、安装 Nvidia 驱动")]),a._v(" "),t("p",[a._v("主机上必须先安装 Nvidia 驱动，容器才能使用 GPU。")]),a._v(" "),t("h3",{attrs:{id:"方式一-手动安装指定版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方式一-手动安装指定版本"}},[a._v("#")]),a._v(" 方式一：手动安装指定版本")]),a._v(" "),t("p",[a._v("进入 "),t("a",{attrs:{href:"https://www.nvidia.cn/drivers/lookup/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Nvidia 官网"),t("OutboundLink")],1),a._v(" 下载对应系统驱动，或参考 "),t("a",{attrs:{href:"https://docs.nvidia.com/datacenter/tesla/driver-installation-guide/index.html#ubuntu",target:"_blank",rel:"noopener noreferrer"}},[a._v("Ubuntu 官方安装文档"),t("OutboundLink")],1),a._v("。")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 设置变量（根据需要修改）")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("version")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("570.133")]),a._v(".20\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("distro")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("ubuntu2204\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("arch_ext")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("amd64.deb\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 安装依赖")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" linux-headers-"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("uname")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 下载并添加 Nvidia 源")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://developer.download.nvidia.com/compute/nvidia-driver/"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$version")]),a._v("/local_installers/nvidia-driver-local-repo-"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$distro")]),a._v("-"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$version_")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$arch_ext")]),a._v(".deb\ndpkg "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" nvidia-driver-local-repo-"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$distro")]),a._v("-"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$version_")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$arch_ext")]),a._v(".deb\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 更新源并导入密钥")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" update\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" /var/nvidia-driver-local-repo-"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$distro")]),a._v("-"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$version")]),a._v("/nvidia-driver-*-keyring.gpg /usr/share/keyrings/\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看可用驱动版本")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" search nvidia-driver\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 安装驱动")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" nvidia-driver-570\n")])])]),t("h3",{attrs:{id:"方式二-自动安装推荐版本-推荐"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方式二-自动安装推荐版本-推荐"}},[a._v("#")]),a._v(" 方式二：自动安装推荐版本（推荐）")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看当前系统推荐的 NVIDIA 驱动版本")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" ubuntu-drivers devices\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 自动安装推荐驱动")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" ubuntu-drivers autoinstall\n")])])]),t("h3",{attrs:{id:"验证驱动安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#验证驱动安装"}},[a._v("#")]),a._v(" 验证驱动安装")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("nvidia-smi\n")])])]),t("p",[a._v("正常输出示例：")]),a._v(" "),t("div",{staticClass:"language-txt extra-class"},[t("pre",{pre:!0,attrs:{class:"language-txt"}},[t("code",[a._v("Thu May 22 14:43:38 2025\n+-----------------------------------------------------------------------------------------+\n| NVIDIA-SMI 570.133.20             Driver Version: 570.133.20     CUDA Version: 12.8     |\n|-----------------------------------------+------------------------+----------------------+\n| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |\n| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |\n|                                         |                        |               MIG M. |\n|=========================================+========================+======================|\n|   0  Tesla T4                       Off |   00000000:00:07.0 Off |                    0 |\n| N/A   34C    P8              9W /   70W |       8MiB /  15360MiB |      0%      Default |\n|                                         |                        |                  N/A |\n+-----------------------------------------+------------------------+----------------------+\n\n+-----------------------------------------------------------------------------------------+\n| Processes:                                                                              |\n|  GPU   GI   CI              PID   Type   Process name                        GPU Memory |\n|        ID   ID                                                               Usage      |\n|=========================================================================================|\n|    0   N/A  N/A            1140      G   /usr/lib/xorg/Xorg                        4MiB |\n+-----------------------------------------------------------------------------------------+\n")])])]),t("h2",{attrs:{id:"三、安装-cuda-toolkit-可选"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三、安装-cuda-toolkit-可选"}},[a._v("#")]),a._v(" 三、安装 CUDA Toolkit（可选）")]),a._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[a._v("提示")]),a._v(" "),t("p",[a._v("深度学习等需要 CUDA 环境的场景才需要安装，如果只需 GPU 加速可跳过此步骤。")])]),a._v(" "),t("p",[a._v("参考 "),t("a",{attrs:{href:"https://developer.nvidia.com/cuda-downloads?target_os=Linux&target_arch=x86_64&Distribution=Ubuntu&target_version=22.04&target_type=deb_local",target:"_blank",rel:"noopener noreferrer"}},[a._v("CUDA 官网"),t("OutboundLink")],1)]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 下载并添加 CUDA 源")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2204/x86_64/cuda-ubuntu2204.pin\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("mv")]),a._v(" cuda-ubuntu2204.pin /etc/apt/preferences.d/cuda-repository-pin-600\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://developer.download.nvidia.com/compute/cuda/12.9.0/local_installers/cuda-repo-ubuntu2204-12-9-local_12.9.0-575.51.03-1_amd64.deb\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" dpkg "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" cuda-repo-ubuntu2204-12-9-local_12.9.0-575.51.03-1_amd64.deb\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" /var/cuda-repo-ubuntu2204-12-9-local/cuda-*-keyring.gpg /usr/share/keyrings/\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 更新源并安装")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-get")]),a._v(" update\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-get")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" cuda-toolkit-12-9\n")])])]),t("h3",{attrs:{id:"验证-cuda-安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#验证-cuda-安装"}},[a._v("#")]),a._v(" 验证 CUDA 安装")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("nvcc "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--version")]),a._v("\n")])])]),t("h2",{attrs:{id:"四、安装-nvidia-container-toolkit"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#四、安装-nvidia-container-toolkit"}},[a._v("#")]),a._v(" 四、安装 nvidia-container-toolkit")]),a._v(" "),t("p",[a._v("这是让 Docker 容器能够使用 GPU 的关键组件。")]),a._v(" "),t("p",[a._v("参考 "),t("a",{attrs:{href:"https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("Nvidia 官方文档"),t("OutboundLink")],1)]),a._v(" "),t("h3",{attrs:{id:"添加-nvidia-源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加-nvidia-源"}},[a._v("#")]),a._v(" 添加 Nvidia 源")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-fsSL")]),a._v(" https://nvidia.github.io/libnvidia-container/gpgkey "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" gpg "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dearmor")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-L")]),a._v(" https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sed")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'s#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("tee")]),a._v(" /etc/apt/sources.list.d/nvidia-container-toolkit.list\n")])])]),t("h3",{attrs:{id:"安装-toolkit"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-toolkit"}},[a._v("#")]),a._v(" 安装 toolkit")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-get")]),a._v(" update\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-get")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" nvidia-container-toolkit\n")])])]),t("h2",{attrs:{id:"五、配置-docker-使用-nvidia-runtime"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#五、配置-docker-使用-nvidia-runtime"}},[a._v("#")]),a._v(" 五、配置 Docker 使用 Nvidia Runtime")]),a._v(" "),t("h3",{attrs:{id:"配置-docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置-docker"}},[a._v("#")]),a._v(" 配置 Docker")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" nvidia-ctk runtime configure "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--runtime")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("docker\n")])])]),t("h3",{attrs:{id:"重启-docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#重启-docker"}},[a._v("#")]),a._v(" 重启 Docker")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" systemctl restart "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v("\n")])])]),t("h3",{attrs:{id:"验证配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#验证配置"}},[a._v("#")]),a._v(" 验证配置")]),a._v(" "),t("p",[a._v("查看 Docker 配置文件：")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" /etc/docker/daemon.json\n")])])]),t("p",[a._v("应该出现如下结果：")]),a._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"default-runtime"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"nvidia"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"runtimes"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"nvidia"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"args"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"path"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"nvidia-container-runtime"')]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[a._v("提示")]),a._v(" "),t("p",[a._v("如果已有其他配置，请合并到现有配置中，不要直接覆盖。")])]),a._v(" "),t("h2",{attrs:{id:"六、容器中使用-gpu"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#六、容器中使用-gpu"}},[a._v("#")]),a._v(" 六、容器中使用 GPU")]),a._v(" "),t("h3",{attrs:{id:"docker-cli-使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-cli-使用"}},[a._v("#")]),a._v(" Docker CLI 使用")]),a._v(" "),t("h4",{attrs:{id:"基本参数说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基本参数说明"}},[a._v("#")]),a._v(" 基本参数说明")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",[a._v("参数")]),a._v(" "),t("th",[a._v("说明")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[t("code",[a._v("--gpus all")])]),a._v(" "),t("td",[a._v("将所有 GPU 分配给容器")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v('--gpus "device=0"')])]),a._v(" "),t("td",[a._v("只分配 GPU 0")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v('--gpus "device=0,1"')])]),a._v(" "),t("td",[a._v("分配 GPU 0 和 1")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v("--gpus '\"device=0,1\"'")])]),a._v(" "),t("td",[a._v("分配 GPU 0 和 1（某些 shell 需要额外引号）")])]),a._v(" "),t("tr",[t("td",[t("code",[a._v("--gpus 2")])]),a._v(" "),t("td",[a._v("分配任意 2 个 GPU")])])])]),a._v(" "),t("h4",{attrs:{id:"测试容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#测试容器"}},[a._v("#")]),a._v(" 测试容器")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--gpus")]),a._v(" all nvidia/cuda:12.8.0-runtime-ubuntu22.04 nvidia-smi\n")])])]),t("p",[a._v("成功输出会显示容器内的 GPU 信息。")]),a._v(" "),t("h4",{attrs:{id:"指定-gpu"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#指定-gpu"}},[a._v("#")]),a._v(" 指定 GPU")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 只使用第一块 GPU")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--gpus")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"device=0"')]),a._v(" nvidia/cuda:12.8.0-runtime-ubuntu22.04 nvidia-smi\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用指定多块 GPU")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--gpus")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"device=0,2"')]),a._v(" nvidia/cuda:12.8.0-runtime-ubuntu22.04 nvidia-smi\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用任意两块 GPU")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--gpus")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" nvidia/cuda:12.8.0-runtime-ubuntu22.04 nvidia-smi\n")])])]),t("h4",{attrs:{id:"gpu-资源限制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#gpu-资源限制"}},[a._v("#")]),a._v(" GPU 资源限制")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 限制使用 GPU 0 的一半内存")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--gpus")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'\"device=0\"'")]),a._v(" --shm-size"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("1g nvidia/cuda:12.8.0-runtime-ubuntu22.04 nvidia-smi\n")])])]),t("h3",{attrs:{id:"docker-compose-使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-使用"}},[a._v("#")]),a._v(" Docker Compose 使用")]),a._v(" "),t("h4",{attrs:{id:"基本配置-推荐写法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基本配置-推荐写法"}},[a._v("#")]),a._v(" 基本配置（推荐写法）")]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cuda12")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nvidia/cuda"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("12.8.0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("runtime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("ubuntu22.04\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("container_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" cuda12.8\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("restart")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"no"')]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("environment")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("NVIDIA_DRIVER_CAPABILITIES")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" compute"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("video"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("utility\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("stdin_open")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("true")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("tty")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("true")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("deploy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("resources")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("reservations")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("devices")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("driver")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nvidia\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("count")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" all\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("capabilities")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("gpu"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("command")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"nvidia-smi"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])])]),t("h4",{attrs:{id:"指定-gpu-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#指定-gpu-2"}},[a._v("#")]),a._v(" 指定 GPU")]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ai-service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" your"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("ai"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("image"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("latest\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("deploy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("resources")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("reservations")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("devices")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("driver")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nvidia\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("device_ids")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'0'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'1'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 指定 GPU 0 和 1")]),a._v("\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("capabilities")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("gpu"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])])]),t("h4",{attrs:{id:"环境变量说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境变量说明"}},[a._v("#")]),a._v(" 环境变量说明")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",[a._v("环境变量")]),a._v(" "),t("th",[a._v("说明")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[t("code",[a._v("NVIDIA_DRIVER_CAPABILITIES")])]),a._v(" "),t("td",[a._v("GPU 能力列表，如 "),t("code",[a._v("compute,utility,video,graphics")])])]),a._v(" "),t("tr",[t("td",[t("code",[a._v("NVIDIA_VISIBLE_DEVICES")])]),a._v(" "),t("td",[a._v("指定可见 GPU，如 "),t("code",[a._v("0,1")]),a._v(" 或 "),t("code",[a._v("all")])])])])]),a._v(" "),t("p",[a._v("查看变量值：")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$NVIDIA_DRIVER_CAPABILITIES")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#同时可以看 GPU 可见性")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$NVIDIA_VISIBLE_DEVICES")]),a._v("\n")])])]),t("p",[a._v("查看容器：")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" inspect container_name  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--format")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'{{json .HostConfig.DeviceRequests}}'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" jq\n")])])]),t("p",[a._v("示例：")]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ai-service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" your"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("ai"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("image"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("latest\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("environment")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("NVIDIA_VISIBLE_DEVICES")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 只使用 GPU 0 和 1")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("NVIDIA_DRIVER_CAPABILITIES")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" compute"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("utility\n")])])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[a._v("提示")]),a._v(" "),t("p",[a._v("配置了 "),t("code",[a._v("default-runtime: nvidia")]),a._v(" 后，"),t("code",[a._v("docker-compose")]),a._v(" 配置可省略 "),t("code",[a._v("runtime: nvidia")])])]),a._v(" "),t("h2",{attrs:{id:"七、常见问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#七、常见问题"}},[a._v("#")]),a._v(" 七、常见问题")]),a._v(" "),t("h3",{attrs:{id:"_1-nvidia-container-toolkit-安装失败"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-nvidia-container-toolkit-安装失败"}},[a._v("#")]),a._v(" 1. nvidia-container-toolkit 安装失败")]),a._v(" "),t("p",[t("strong",[a._v("问题")]),a._v("："),t("code",[a._v("E: Unable to locate package nvidia-container-toolkit")])]),a._v(" "),t("p",[t("strong",[a._v("解决")]),a._v("：")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 检查源是否正确添加")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" /etc/apt/sources.list.d/nvidia-container-toolkit.list\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 手动添加源（适用于 Ubuntu 22.04）")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-L")]),a._v(" https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sed")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'s#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("tee")]),a._v(" /etc/apt/sources.list.d/nvidia-container-toolkit.list\n")])])]),t("h3",{attrs:{id:"_2-容器内无法识别-gpu"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-容器内无法识别-gpu"}},[a._v("#")]),a._v(" 2. 容器内无法识别 GPU")]),a._v(" "),t("p",[t("strong",[a._v("问题")]),a._v("："),t("code",[a._v("docker: Error response from daemon: could not select device driver")])]),a._v(" "),t("p",[t("strong",[a._v("解决")]),a._v("：")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 确认 nvidia-container-toolkit 已安装")]),a._v("\ndpkg "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" nvidia-container-toolkit\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 重新配置 Docker")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" nvidia-ctk runtime configure "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--runtime")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("docker\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" systemctl restart "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v("\n")])])]),t("h3",{attrs:{id:"_3-多-gpu-环境下指定-gpu-无效"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-多-gpu-环境下指定-gpu-无效"}},[a._v("#")]),a._v(" 3. 多 GPU 环境下指定 GPU 无效")]),a._v(" "),t("p",[t("strong",[a._v("问题")]),a._v("：设置了 "),t("code",[a._v('--gpus "device=0"')]),a._v(" 但容器仍能看到所有 GPU")]),a._v(" "),t("p",[t("strong",[a._v("解决")]),a._v("：检查 "),t("code",[a._v("NVIDIA_VISIBLE_DEVICES")]),a._v(" 环境变量")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--gpus")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"device=0"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("NVIDIA_VISIBLE_DEVICES")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(" nvidia/cuda:12.8.0-runtime-ubuntu22.04 nvidia-smi\n")])])]),t("h3",{attrs:{id:"_4-gpu-内存不足"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-gpu-内存不足"}},[a._v("#")]),a._v(" 4. GPU 内存不足")]),a._v(" "),t("p",[t("strong",[a._v("解决")]),a._v("：")]),a._v(" "),t("ul",[t("li",[a._v("调整 "),t("code",[a._v("--shm-size")]),a._v(" 参数增加共享内存")]),a._v(" "),t("li",[a._v("使用 "),t("code",[a._v("--gpus")]),a._v(" 参数限制 GPU 数量")]),a._v(" "),t("li",[a._v("考虑使用模型量化或梯度累积等技术")])]),a._v(" "),t("h2",{attrs:{id:"八、参考链接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#八、参考链接"}},[a._v("#")]),a._v(" 八、参考链接")]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("NVIDIA Container Toolkit 官方文档"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://developer.nvidia.com/cuda-downloads",target:"_blank",rel:"noopener noreferrer"}},[a._v("CUDA 下载页面"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/config/containers/resource_constraints/#gpu",target:"_blank",rel:"noopener noreferrer"}},[a._v("Docker GPU 支持文档"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=n.exports}}]);