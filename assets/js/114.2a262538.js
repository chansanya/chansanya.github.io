(window.webpackJsonp=window.webpackJsonp||[]).push([[114],{459:function(a,t,s){"use strict";s.r(t);var e=s(14),l=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("p",[a._v("docker版本gitlab迁移\n")]),a._v(" "),t("h3",{attrs:{id:"开始备份"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开始备份"}},[a._v("#")]),a._v(" 开始备份")]),a._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[a._v("注意")]),a._v(" "),t("p",[a._v("在迁移 gitlab 数据前首先要确保新旧服务器上安装的 gitlab 版本是一致的。")]),a._v(" "),t("p",[a._v("GitLab不能跨版本升级，需一个一个大版本"),t("RouterLink",{attrs:{to:"/pages/85e387/#升级至指定版本"}},[a._v("升级")]),a._v("。")],1)]),a._v(" "),t("p",[a._v("首先需要进入容器，"),t("RouterLink",{attrs:{to:"/pages/cec93e/#进入容器"}},[a._v("可参考")])],1),a._v(" "),t("h3",{attrs:{id:"备份"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#备份"}},[a._v("#")]),a._v(" 备份")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("gitlab-rake gitlab:backup:create\n")])])]),t("p",[a._v("会在 "),t("code",[a._v("/var/opt/gitlab/backups/")]),a._v(" 生成备份文件，需要将新备份上传到新的gitlab服务器中。")]),a._v(" "),t("h3",{attrs:{id:"停止新服务器上gitlab数据连接服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#停止新服务器上gitlab数据连接服务"}},[a._v("#")]),a._v(" 停止新服务器上gitlab数据连接服务")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 关闭Web界面")]),a._v("\ngitlab-ctl stop unicorn\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 关闭Web界面")]),a._v("\ngitlab-ctl stop puma\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 关闭异步任务")]),a._v("\ngitlab-ctl stop sidekiq\n")])])]),t("h4",{attrs:{id:"恢复备份文件到gitlab"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#恢复备份文件到gitlab"}},[a._v("#")]),a._v(" 恢复备份文件到GitLab")]),a._v(" "),t("p",[a._v("指定文件恢复")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("gitlab-backup restore "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("BACKUP")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("备份文件名"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),t("p",[a._v("恢复至最新")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("gitlab-backup restore\n")])])]),t("h4",{attrs:{id:"重启gitlab"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#重启gitlab"}},[a._v("#")]),a._v(" 重启gitlab")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("gitlab-ctl restart\n")])])]),t("p",[a._v("也可以直接重启gitlab的docker容器")]),a._v(" "),t("h3",{attrs:{id:"附"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#附"}},[a._v("#")]),a._v(" 附")]),a._v(" "),t("h4",{attrs:{id:"升级至指定版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级至指定版本"}},[a._v("#")]),a._v(" 升级至指定版本")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" gitlab-ce-10.8.7-ce.0.el7\n")])])]),t("h4",{attrs:{id:"升级至最新"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级至最新"}},[a._v("#")]),a._v(" 升级至最新")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" gitlab-ce  \n")])])])])}),[],!1,null,null,null);t.default=l.exports}}]);